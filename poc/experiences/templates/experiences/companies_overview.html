{% extends "experiences/base.html" %}

{% block content %}

{% comment %}
  Título de la página:
  - Texto visible arriba del listado
  - Clases de Bootstrap para color y margen
{% endcomment %}
<h1 class="text-light mb-4">Resumen por empresa</h1>

{% comment %}
  Condición: ¿hay compañías con resumen?
  - La vista companies_overview pasa el queryset "companies"
    (CompanySummary.objects.order_by("company"))
  - Si está vacío, mostramos el mensaje "Aún no hay resúmenes."
{% endcomment %}
{% if companies %}

  {% comment %}
    Contenedor tipo "list-group" (Bootstrap)
    - Agrupa cada empresa como un ítem clicable
  {% endcomment %}
  <div class="list-group">

    {% comment %}
      Bucle: iteramos cada CompanySummary (c)
      - c.company: nombre de la empresa
      - c.last_computed: última fecha/hora del cálculo
      - c.summary: texto del resumen (truncado a 220 chars)
      - c.total_posts / c.total_comments: métricas
      - El <a> lleva al detalle con la URL "company_summary_detail"
    {% endcomment %}
    {% for c in companies %}
      <a
        class="list-group-item list-group-item-action bg-dark text-light mb-2 border rounded"
        href="{% url 'company_summary_detail' c.company %}"
      >
        <div class="d-flex w-100 justify-content-between">
          <h5 class="mb-1">{{ c.company }}</h5>
          <small>Actualizado: {{ c.last_computed|date:"Y-m-d H:i" }}</small>
        </div>

        {% comment %} Vista previa del resumen (truncada) {% endcomment %}
        <p class="mb-1">{{ c.summary|truncatechars:220 }}</p>

        {% comment %} Métricas por empresa {% endcomment %}
        <small>{{ c.total_posts }} publicaciones · {{ c.total_comments }} comentarios</small>
      </a>
    {% endfor %}
  </div>

{% else %}
  <p class="text-muted">Aún no hay resúmenes.</p>
{% endif %}

{% endblock %}
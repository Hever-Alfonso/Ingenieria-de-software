{% extends "experiences/base.html" %}

{% block content %}

{% comment %}
  Ajuste de estilo
  - Redefinimos el color de .text-muted para mayor contraste en fondo oscuro
{% endcomment %}
<style>
  .text-muted { color: #e9eef7 !important; }
</style>

{% comment %}
  Tarjeta principal con los detalles de la publicación
{% endcomment %}
<div class="card">
  <div class="card-body">
    
    {% comment %} Nombre de la empresa como "badge" destacado {% endcomment %}
    <span class="badge bg-primary mb-2">{{ e.company }}</span>
    
    {% comment %} Título de la publicación {% endcomment %}
    <h2 class="h5 text-white mb-2">{{ e.title }}</h2>
    
    {% comment %} Resumen breve de la publicación {% endcomment %}
    <p class="text-muted mb-2">{{ e.summary }}</p>
    
    {% comment %} Cuerpo completo de la publicación {% endcomment %}
    <p class="text-white">{{ e.body }}</p>

    {% comment %} Fecha de creación en formato YYYY-MM-DD HH:mm {% endcomment %}
    <p class="text-muted small text-end mb-0">
      {{ e.created_at|date:"Y-m-d H:i" }}
    </p>

    {% comment %} Botones de navegación {% endcomment %}
    <a href="{% url 'home' %}" class="btn btn-outline-light mt-3">Volver</a>
    <a href="{% url 'company_summary_detail' e.company %}" class="btn btn-info mt-3">
      Ver resumen general de {{ e.company }}
    </a>
  </div>
</div>

{% comment %}
  Sección de comentarios
  - Lista si existen
  - Texto neutro si no hay
{% endcomment %}
<div class="mt-4">
  <h3 class="h5 text-light">Comentarios</h3>

  {% if e.comments.all %}
    <ul class="list-group">
      {% for c in e.comments.all %}
        <li class="list-group-item bg-dark text-light mb-2 border rounded">
          <div class="d-flex justify-content-between">
            <strong>{{ c.author.username|default:"Anónimo" }}</strong>
            <small class="text-muted">
              {{ c.created_at|date:"Y-m-d H:i" }}
            </small>
          </div>
          <p class="mb-0">{{ c.text }}</p>
        </li>
      {% endfor %}
    </ul>
  {% else %}
    <p class="text-muted">Aún no hay comentarios.</p>
  {% endif %}
</div>

{% comment %}
  Formulario de nuevo comentario
  - Solo si está autenticado
  - Incluye CSRF
{% endcomment %}
{% if request.user.is_authenticated %}
  <div class="mt-3">
    <form method="post" class="card card-body bg-dark text-light">
      {% csrf_token %}
      {{ cform.as_p }}
      <button class="btn btn-primary">Publicar comentario</button>
    </form>
  </div>
{% else %}
  <p class="mt-3">
    <a class="btn btn-outline-info" href="{% url 'login' %}">Inicia sesión</a> para comentar.
  </p>
{% endif %}

{% endblock %}